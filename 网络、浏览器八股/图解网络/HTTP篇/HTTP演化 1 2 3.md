### HTTP特性

到目前为止，HTTP 常见到版本有 HTTP/1.1，HTTP/2.0，HTTP/3.0，不同版本的 HTTP 特性是不一样的。

#### HTTP/1.1 优点

HTTP 最凸出的优点是「简单、灵活和易于扩展、应用广泛和跨平台」。

1. 简单

HTTP基本的报文格式是`header + body`，头部信息也是`keey-value`简单文本的形式，易于理解。

2. 灵活和易于扩展

HTTP里的各种请求方法、URL、状态码、头部字段等每个组成要求都没有被固定死，都允许开发人员**自定义和扩充**。

同时，由于HTTP工作在应用层，它的下层可以随意变化：

+ HTTPS就是在HTTP和TCP之间增加了SSL/TLS安全传输层
+ HTTP/1.0 和 HTTP/2.0传输协议使用的是TCP协议，而HTTP/3.0改用UDP协议

3. 应用广泛和跨平台

#### HTTP/1.1 缺点

HTTP 协议里有优缺点一体的**双刃剑**，分别是「无状态、明文传输」，同时还有一大缺点「不安全」。

1. **无状态**双刃剑

无状态的**好处**，因为服务器不会去记忆HTTP的状态，不需要额外的资源来记录状态信息，这能减轻服务器的负担，能够把更多的 CPU 和内存用来对外提供服务。

无状态的**坏处**，既然服务器没有记忆能力，它在完成有关联性的操作时会非常麻烦。

例如登录->添加购物车->下单->结算->支付，这系列操作都要知道用户的身份才行。但服务器不知道这些请求是有关联的，每次都要问一遍身份信息。

对于无状态的问题，解法方案有很多种，其中比较简单的方式用 **Cookie** 技术。

`Cookie` 通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。

> 客户端第一次发请求后，服务器会生成Cookie，用来保存客户的信息，并在响应报文中添加Cookie后返回。
>
> 第二次以后，客户端发送请求时，在请求报文中添加Cookie，服务器就能识别到Cookie中保存的用户身份。

2. **明文传输**双刃剑

明文意味着在传输过程中的信息，是可方便阅读的，比如 Wireshark 抓包都可以直接肉眼查看，为我们调试工作带了极大的便利性。

但是这正是这样，HTTP 的所有信息都暴露在了光天化日下，相当于**信息裸奔**。在传输的漫长的过程中，信息的内容都毫无隐私可言，很容易就能被窃取。

3. **不安全**

HTTP 比较严重的缺点就是不安全：

- 通信使用明文（不加密），内容可能会被窃听。比如，**账号信息容易泄漏，那你号没了。**
- 不验证通信方的身份，因此有可能遭遇伪装。比如，**访问假的淘宝、拼多多，那你钱没了。**
- 无法证明报文的完整性，所以有可能已遭篡改。比如，**网页上植入垃圾广告，视觉污染，眼没了。**

HTTP 的安全问题，可以用 HTTPS 的方式解决，也就是通过引入 SSL/TLS 层，使得在安全上达到了极致。

#### HTTP/1.1的性能

HTTP 协议是基于 **TCP/IP**，并且使用了「**请求 - 应答**」的通信模式，所以性能的关键就在这**两点**里。

1. **长连接**

早期 HTTP/1.0 性能上的一个很大的问题，那就是每发起一个请求，都要新建一次 TCP 连接（三次握手），而且是串行请求，做了无谓的 TCP 连接建立和断开，增加了通信开销。

为了解决上述 TCP 连接问题，HTTP/1.1 提出了**长连接**的通信方式，也叫持久连接。这种方式的好处在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

持久连接的特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。

<img src="C:\Users\MSK\AppData\Roaming\Typora\typora-user-images\image-20221027125127196.png" alt="image-20221027125127196" style="zoom:30%;" />

当然，如果某个 HTTP 长连接超过一定时间没有任何数据交互，服务端就会主动断开这个连接。

2. **管道网络传输**

同一个TCP连接中，客户端能发送多个请求，第一个请求发出去后，不需要等待第一个请求的结果就可以直接发送第二个请求，可以**减少整体的响应时间**

<img src="C:\Users\MSK\AppData\Roaming\Typora\typora-user-images\image-20221027125427134.png" alt="image-20221027125427134" style="zoom:30%;" />

但是，**服务器必须按照发送请求的顺序返回响应**，如果处理第一个请求花费的时间过长，那么后面的请求都会被阻塞，这被称为【队头阻塞】

所以，HTTP/1.1的管道网络传输只解决了请求的队头阻塞，没有解决响应的队头阻塞。

> **注意：**
>
> 实际上，HTTP/1.1的管道通信默认不开启，而且很多浏览器不支持，所以下面的讨论都建立在不是管道通信的基础上。

总之 HTTP/1.1 的性能一般般，后续的 HTTP/2 和 HTTP/3 就是在优化 HTTP 的性能。

### HTTP/1.1 HTTP/2 HTTP/3 演化

#### HTTP/1.1 相比 HTTP/1.0 提高了什么性能？

**性能上：**

+ 使用长连接的方式改善了HTTP/1.0 短连接造成的性能开销
  + 短连接，每发一次请求都要进行TCP三次握手
+ 支持管道网络传输，只要第一个请求发送出去，不必等其回来，就可以发送第二个请求，可以减少整体的等待时间

**HTTP/1.1 性能瓶颈：**

+ 请求/响应头部 未经压缩就发送，首部信息越多，延迟越大。只能压缩Body部分
+ 每次发送相同的首部浪费资源
+ 服务器按照请求的顺序响应，如果服务器响应慢，客户端一直受不到请求，也就是队头阻塞
+ 没有请求优先控制
+ 请求只能从客户端开始，服务器只能被动响应

